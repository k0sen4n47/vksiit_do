console.log("student-assignment.js loaded");document.addEventListener("DOMContentLoaded",function(){console.log("student-assignment.js loaded");const l=document.getElementById("finalAnswerForm"),u=document.getElementById("editAnswerForm");function m(t){t.preventDefault();const e=t.target,o=e.querySelector('button[type="submit"]'),d=o.textContent;o.disabled=!0,o.textContent="Отправка...";const w=new FormData(e);fetch(e.action,{method:"POST",body:w,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json"}}).then(n=>(console.log("Response status:",n.status),console.log("Response headers:",n.headers),n.ok?n.json():n.json().then(b=>{throw console.error("Server error:",b),new Error(b.message||"Network response was not ok")}))).then(n=>{if(console.log("Success response:",n),n.success)y(n.message||"Ответ успешно отправлен!"),setTimeout(()=>{window.location.reload()},1500);else throw new Error(n.message||"Произошла ошибка при отправке ответа")}).catch(n=>{console.error("Error details:",n),o.disabled=!1,o.textContent=d,h(n.message||"Произошла ошибка при отправке ответа")})}function y(t){const e=document.createElement("div");e.className="alert alert-success",e.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 9999; padding: 15px; background: #d4edda; color: #155724; border: 1px solid #c3e6cb; border-radius: 4px;",e.textContent=t,document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}function h(t){const e=document.createElement("div");e.className="alert alert-danger",e.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 9999; padding: 15px; background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 4px;",e.textContent=t,document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}l&&l.addEventListener("submit",m),u&&u.addEventListener("submit",m);const x=document.getElementById("assignment-pages"),g=Array.from(x.querySelectorAll(".student-assignment-view__page")),c=g.length;let s=0;const i=document.getElementById("prev-page"),r=document.getElementById("next-page"),f=document.getElementById("current-page");function E(t){const e=document.getElementById("progress-bar-inner"),o=c;if(e&&o>1){const d=(t+1)/o*100;e.style.width=d+"%"}else e&&(e.style.width="100%")}function p(){typeof tinymce<"u"&&(tinymce.remove(),tinymce.init({selector:"textarea.tinymce-student",language:"ru",language_url:"/js/tinymce/langs/ru.js",menubar:!1,plugins:"lists link image table",toolbar:"undo redo | bold italic underline | bullist numlist | link image table",height:250,license_key:"gpl"}))}function a(t){g.forEach((e,o)=>{e.style.display=o===t?"block":"none"}),f&&(f.textContent=t+1),E(t),t===0?i&&i.classList.add("btn-cabinet--disabled"):i&&i.classList.remove("btn-cabinet--disabled"),t===c-1?r&&r.classList.add("btn-cabinet--disabled"):r&&r.classList.remove("btn-cabinet--disabled"),p()}i&&i.addEventListener("click",function(){console.log("prev clicked"),s>0&&(s--,a(s))}),r&&r.addEventListener("click",function(){console.log("next clicked"),s<c-1&&(s++,a(s))}),a(s),p()});
